---
title: 文件系统
date: 2017-10-25 21:12:09
categories: [linux, 系统管理]
---

<!-- TOC -->

- [1. 文件属性](#1-文件属性)
    - [1.1. 改变文件属性与权限](#11-改变文件属性与权限)
        - [1.1.1. 文件权限](#111-文件权限)
        - [1.1.2. umask](#112-umask)
- [2. 文件种类与扩展名](#2-文件种类与扩展名)
- [3. Hierarchy Standard (FHS)文件标准](#3-hierarchy-standard-fhs文件标准)
    - [3.1. 四个类型](#31-四个类型)
    - [3.2. 其实只定义出三层目录下面应该放置什么数据](#32-其实只定义出三层目录下面应该放置什么数据)
    - [3.3. 目录表格](#33-目录表格)
        - [3.3.1. 常见](#331-常见)
        - [3.3.2. /usr](#332-usr)
        - [3.3.3. /var](#333-var)
        - [3.3.4. centos7的链接](#334-centos7的链接)
    - [3.4. 目录树](#34-目录树)
- [4. 目录相关](#4-目录相关)
- [5. 文件隐藏属性](#5-文件隐藏属性)
- [6. 文件的特殊权限: SUID,SGID,SBIT](#6-文件的特殊权限-suidsgidsbit)
    - [6.1. SUID的作用](#61-suid的作用)
    - [6.2. SGID的作用](#62-sgid的作用)
    - [6.3. SBIT的作用](#63-sbit的作用)
    - [6.4. 权限设置](#64-权限设置)
    - [6.5. 大写S或大写T](#65-大写s或大写t)
- [7. Quota磁盘配额](#7-quota磁盘配额)
    - [7.1. 使用限制](#71-使用限制)
    - [7.2. 相关指令](#72-相关指令)
- [8. RAID 容错式廉价磁盘阵列](#8-raid-容错式廉价磁盘阵列)
    - [8.1. RAID0 (等量模式,stripe): 性能模式](#81-raid0-等量模式stripe-性能模式)
    - [8.2. RAID1 (映射模式,mirror): 完整备份](#82-raid1-映射模式mirror-完整备份)
    - [8.3. RAID 1+0, RAID 0+1](#83-raid-10-raid-01)
    - [8.4. RAID 5](#84-raid-5)
    - [8.5. 磁盘阵列的有优点](#85-磁盘阵列的有优点)
- [9. 查看文件内容的多种方式](#9-查看文件内容的多种方式)
- [10. 常用命令](#10-常用命令)

<!-- /TOC -->


<a id="markdown-1-文件属性" name="1-文件属性"></a>
# 1. 文件属性

* 第一栏代表这个文件的类型与权限,`[d]是目录,[-]是文件`
* 接下来三组分别为`文件拥有者可具备的权限`,`加入此群组之账号的权限`,`非本人且没有加入本群组之其他账号的权限`
* 第二栏表示有多少文件名链接到此节点(i-node)
* 第三栏表示这个文件的"拥有者账号"
* 第四栏表示这个文件的所属群组
* 第五栏表示这个文件的容量大小,默认单位为Bytes
* 第六栏为这个文件的创建日期或者最近的修改日期
```
drwxr-xr-x  23 root root  4096 8月  27 13:49 .
drwxr-xr-x  23 root root  4096 8月  27 13:49 ..
drwxr-xr-x  2 root root  4096 7月  5 18:59 bin
drwxr-xr-x  4 root root  2560 1月  1  1970 boot
-rw-r--r--  1 root root    4 11月 16  2016 debian-binary
```

<a id="markdown-11-改变文件属性与权限" name="11-改变文件属性与权限"></a>
## 1.1. 改变文件属性与权限
* chgrp: 改变文件所属群组 (chown就够了)
* chown: 改变文件拥有者
* chmod: 改变文件的权限,SUID,SGID,SBIT等等的特性

<a id="markdown-111-文件权限" name="111-文件权限"></a>
### 1.1.1. 文件权限

```bash
# 分数相加
# owner = rwx = 4 + 2 + 1 =7
# group = rwx = 4 + 2 + 1 = 7
# others = --- = 0 + 0 + 0 = 0

# 默认文件权限(o=rw,g=r,o=r)
chmod 644

# 默认目录权限(o=rwx,g=rx,o=rx)
chmod 755 
```
<a id="markdown-112-umask" name="112-umask"></a>
### 1.1.2. umask
* 若使用者创建为文件,默认为666,o=rw,g=rw,o=rw,
* 若使用者创建为目录,默认为777,o=rwx,g=rwx,o=rwx

umask的作用是减分,我的机器上分数是0022,则
* 文件666-022=644,o=rw,g=r,o=r
* 目录777-022=755,o=rwx,g=rx,o=rx

这个概念在将来架设文件服务器,SAMBA Server或FTP Servers时都是非常重要的

<a id="markdown-2-文件种类与扩展名" name="2-文件种类与扩展名"></a>
# 2. 文件种类与扩展名
* 正规文件(regular file),第一个属性为[-]
* 目录(directory),第一个属性为[d]
* 链接文件(link),第一个属性为[l]
* 设备与设备文件(device),通常在/dev目录之下
 * 区块(block)设备文件(硬盘,软盘),第一个属性为[b]
 * 字符(character)设备文件,第一个属性为[c]
* 数据接口文件(sockets),通常在/run,/tmp这些个目录之下,第一个属性为[s]
* 数据输送档位(FIFO,pipe),第一个属性为[p]


<a id="markdown-3-hierarchy-standard-fhs文件标准" name="3-hierarchy-standard-fhs文件标准"></a>
# 3. Hierarchy Standard (FHS)文件标准
<a id="markdown-31-四个类型" name="31-四个类型"></a>
## 3.1. 四个类型
* 可分享的: 可以分享给其他系统挂载使用的目录,`/usr(软件放置处),/opt(第三方协力软件),/var(使用者邮件信箱),/var/spool/news(新闻群组)`
* 不可分享的: 自己机器上面运行的设备文件或者是与程序有关的socket文件等,`/etc(配置文件等),/boot(开机与核心档),/var/run(程序相关),/var/lock(程序相关)`
* 不变的: 例如函数库,文件说明文档,系统管理员所管理的主机服务配置文件等等
* 可变动的: 经常改变的数据,例如登录文件,一般用户可自行接受的新闻群组等

<a id="markdown-32-其实只定义出三层目录下面应该放置什么数据" name="32-其实只定义出三层目录下面应该放置什么数据"></a>
## 3.2. 其实只定义出三层目录下面应该放置什么数据
* /(root,根目录): 与开机系统有关
* /usr (unix software resourece): 与软件安装/执行有关
* /var (variable): 与系统运行过程有关

<a id="markdown-33-目录表格" name="33-目录表格"></a>
## 3.3. 目录表格
<a id="markdown-331-常见" name="331-常见"></a>
### 3.3.1. 常见
FHS要求必须要存在的目录

| 目录             | 应放置文件内容                                                                                                                                                       |
| ---------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| /bin             | 单人维护模式下能够被操作的指令,可以被root与一般账户所使用                                                                                                            |
| /boot            | 开机会使用到的文件,Linux Kernel常用的文件名为: vmlinuz,如果使用grub2这个开机管理程序,则还会存在/boot/grub2/这个目录                                                  |
| /dev             | 任何设备与周边设备都是以文件形态存在于这个目录当中的,比较重要的文件有`/dev/null,/dev/zero,/dev/tty,/dev/loop*,/dev/sd*`                                              |
| /etc             | 系统的主要的配置文件,例如人员的账号密码档,各种服务的启始档,FHS建议不要放置可执行文件在这个目录中,比较重要的有`/etc/modprobe.d/, /etc/passwd, /etc/fstab, /etc/issue` |
| /lib             | 系统的函数库,/lib放置的是开机才会用到的函数库,以及在/bin或s/bin下面的指令才会调用到的函数库,`/lib/modules`这个目录主要放置可抽换式的核心相关模块(驱动程序)           |
| /media           | 放置的是可移除的设备,包括软盘,光盘,DVD                                                                                                                               |
| /mnt             | 古老的时候这个目录的用途与/media相同,只是有了/media之后,这个目录就用来暂时挂载                                                                                       |
| /opt             | 给第三方协力软件放置的目录,例如KDE,不过以前的Linux系统中,我们还是习惯放置在/usr.local目录下                                                                          |
| /run             | 系统开机后所产生的各项信息                                                                                                                                           |
| /sbin            | 为开机过程中所需要的,里面包括了开机,修复,还原系统所需要的指令.                                                                                                       |
| /usr/sbin        | 某些服务器软件程序                                                                                                                                                   |
| /usr/local/sbin/ | 本机自行安装的软件所产生的系统可执行文件                                                                                                                             |
| /srv             | 可视作service的缩写,是一些网络服务启动之后,这些服务所需要取用的数据目录,常见的服务例如WWW,FTP                                                                        |
| /tmp             | 正在执行的程序暂时放置文件的地方,开机时应该要将/tmp下的数据都删除                                                                                                    |

FHS建议可以存在的目录

| 目录        | 应放置文件内容                                                                                                                                                                  |
| ----------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| /home       | 系统默认的使用者注文件夹,在你新增一个一般使用者账号时,默认的使用者主文件夹都会规范到这里来,`~:代表的是这个使用者的主文件夹,~pi:则代表pi的注文件夹`                              |
| /lib<qual>  | 用来存放与/lib不同的格式的二进制函数库,例如支持64位的/lib64函数库等                                                                                                             |
| /root       | 系统管理员(root)的主文件夹                                                                                                                                                      |
| /lost+found | 这个目录时使用标准的ext2/ext3/ext4文件系统格式才会产生的一个目录,目的在于当文件系统发生错误时,将一些遗失的片段放置到这个目录下,不过使用的是xfs文件系统的话,就不会存在这个目录了 |
| /sys        | 这个目录其实跟/proc非常类似,也是一个虚拟的文件系统,主要时记录核心与系统硬件信息较相关的信息                                                                                     |

<a id="markdown-332-usr" name="332-usr"></a>
### 3.3.2. /usr
/usr的意义与内容,根据FHS的基本定义,/usr里面放置的数据属于可分享的与不可变动的(sharble,static)  
不要误会/usr为user的缩写,其实usr是Unix Software Resourcede的缩写,也是Unix操作系统软件资源所放置的目录

| 目录        | 应放置文件内容                                                                                                                                                                              |
| ----------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| /usr/bin    | 所有一般用户能够使用的指令都放在这里,目前新的centos7已经讲全部的使用者命令放置与此,而使用链接文件的方式将.bin链接至此,也就是说/usr/bin与/bin是一模一样的了`FHS要求在此目录下不应该有子目录` |
| /usr/lib    | 基本上与/lib功能相同,所以/lib就是链接到此目录中的                                                                                                                                           |
| /usr/local/ | 系统管理员本机自行安装自己下载的软件,建议安装到此目录,这样会比较便于管理(你想安装较新的软件但又不像移除旧版,此时你可以将新版软件安装于/usr/local目录下)                                     |
| /usr/sbin/  | 非系统正常运行所需要的系统指令,最常见的就是某些网络服务器软件的服务指令(daemon),`不过基本与/sbin差不多`,目前/sbin就是链接到此目录中的                                                       |
| /usr/share  | 主要放置只读架构的数据文件,当然也包括共享文件,`/usr/share/man:线上说明文档 ` ` /usr/share/doc: 软件杂项的文件说明` `/usr/share/zoneinfo`与时区有关的时区文件                                |

FHS建议可以存在的目录

| 目录           | 应放置文件内容                                                                                                        |
| -------------- | --------------------------------------------------------------------------------------------------------------------- |
| /usr/games/    | 与游戏相关的数据放置处                                                                                                |
| /usr/include   | c/c++等程序语言的文件开始(header)与包含档(include)放置处,当我们以tarball方式安装某些数据时,会使用到理由的许多包含档哦 |
| /usr/libexec/  | 某些`不被一般使用者惯用`的可执行文件或脚本(script)等等,都会放置在此目录中                                             |
| /usr/lib<qual> | 与/lib<qual>功能相同,因此目前/lib<qual>就是链接到此目录                                                               |
| /usr/src/      | 一般源代码建议放置到这里,src有source的意思,至于核心源代码则建议放置到/usr/src/linux目录下                             |


<a id="markdown-333-var" name="333-var"></a>
### 3.3.3. /var
如果/usr是安装时会占用较大硬盘容量的目录,那么/var/就是在系统运行后才会渐渐占用硬盘容量的目录,因为/var/目录主要是针对常态性变动的文件,包括高速缓存(cache),登录文件(log file)以及某些软件运行所产生的文件,包括程序文件(lock file,run file),或者例如MySQL数据库的文件等等

| 目录        | 应放置文件内容                                                                                               |
| ----------- | ------------------------------------------------------------------------------------------------------------ |
| /var/cache  | 应用程序本身运行过程中会产生的一些暂存盘                                                                     |
| /var/lib    | 需要使用到的数据文件放置的目录,例如,MySQL的数据库放置到/var/lib/mysql而rpm的数据库则放到/var/lib/rpm去       |
| /var/lock   | 设备上锁文件                                                                                                 |
| /var/log    | 登录文件放置的目录,比较重要的例如/var/log/messages,/var/log/wtmp(记录登录者信息)                             |
| /var/mail/  | 放置个人电子邮件信箱的目录,不过目录也被放置到/var/spool/mail/目录中                                          |
| /var/run/   | PID与/run相同                                                                                                |
| /var/spool/ | 这个目录通常放置一些排队等待其他程序使用的数据.如果是工作调度数据(crontab)就会被放置到/var/spool/cron/目录中 |


<a id="markdown-334-centos7的链接" name="334-centos7的链接"></a>
### 3.3.4. centos7的链接
* /bin -> /usr/bin
* /sbin -> /usr/sbin
* /lib -> /usr/lib
* /lib64 -> /usr/lib64
* /var/lock -> /run/lock
* /var/run -> /run


<a id="markdown-34-目录树" name="34-目录树"></a>
## 3.4. 目录树
![](http://ouxarji35.bkt.clouddn.com/snipaste_20170827_210943.png)



<a id="markdown-4-目录相关" name="4-目录相关"></a>
# 4. 目录相关
* .  代表此层目录
* .. 代表上一层目录
* -  代表前一个工作目录
* ~ 代表目前使用者身份所在的主文件夹
* ~account 代表account这个使用者的主文件夹 



<a id="markdown-5-文件隐藏属性" name="5-文件隐藏属性"></a>
# 5. 文件隐藏属性
隐藏属性对于系统有很大的帮助,尤其是在系统安全(Security),`chattr指令只能在Ext2/Ext3/Ext4`的Linux传统文件系统上面完整生效,例如`xks(centos7)`仅支持部分的参数
* A 存取时间atime将不会背修改,可避免I/O较慢的机器过度的存取磁盘
* S 进行任何文件的修改,改更改会同步的写入磁盘中
* `a 文件只能增加数据,而不能删除也不能修改数据,`
* c 自动压缩,读取自动解压缩
* d 当dump程序被执行时候,可使该文件不会被dump备份
* `i  不能被删除,改名设置链接也无法写入或新增数据`
* s  文件被删除时,则数据内容将被完全的移除这个硬盘空间
* u 与s相反,如果该文件被删除了,则数据内容其实还存在磁盘中

xfs文件系统仅支持AadiS
```
# 设置文件隐藏属性
chattr
# 显示文件隐藏属性
lsattr
```

<a id="markdown-6-文件的特殊权限-suidsgidsbit" name="6-文件的特殊权限-suidsgidsbit"></a>
# 6. 文件的特殊权限: SUID,SGID,SBIT
<a id="markdown-61-suid的作用" name="61-suid的作用"></a>
## 6.1. SUID的作用
举例来说,修改密码时,普通用户使用`vim/cat`不能访问`/etc/shadow`,因为`vim/cat`不具有SUID,所以不能读取o=---的文件,但是passwd可以修改,因为`/usr/bin/passwd`具有SUID权限,获得了文件owner的权限  

我的问题:  
既然获得文件owner的权限,为啥不能`passwd root`?  
解答:  
能不能修改其他用户的密码是`passwd程序决定的`,只不过修改密码需要记录到/etc/shadow,所以需要SUID完成对文件的写入  

* SUID权限仅对二进制程序有效
* 执行者对于该程序需要具有x的可执行权限
* 本权限仅在执行该程序过程中有效
* 执行者讲具有该程序拥有者的权限

<a id="markdown-62-sgid的作用" name="62-sgid的作用"></a>
## 6.2. SGID的作用
* SGID对二进制程序有用
* 程序执行者对于该程序来说,需具备x的权限
* 程序在执行的过程中将会获得该程序群组的支持

<a id="markdown-63-sbit的作用" name="63-sbit的作用"></a>
## 6.3. SBIT的作用
* 当使用者对于此目录具有 w, x 权限，亦即具有写入的权限时
* 当使用者在该目录下创建文件或目录时，仅有自己与 root 才有权力删除该文件

<a id="markdown-64-权限设置" name="64-权限设置"></a>
## 6.4. 权限设置
* 4为SUID
* 2为SGID
* 1为SBIT
也可以通过符号来加
* SUID u+s
* SGID g+s
* SBIT o+t

<a id="markdown-65-大写s或大写t" name="65-大写s或大写t"></a>
## 6.5. 大写S或大写T
表示为空,因为本人也没有x权限


<a id="markdown-7-quota磁盘配额" name="7-quota磁盘配额"></a>
# 7. Quota磁盘配额
* 限制某一群组所能使用的最大磁盘配额(群组限制)
* 限制某一使用者的最大磁盘配额(使用使用者限制)
* 限制某一目录(directory,project)的最大磁盘配额

<a id="markdown-71-使用限制" name="71-使用限制"></a>
## 7.1. 使用限制
* 在EXT文件系统家族仅能针对整个filesystem
* 核心必须支持quota,centos7.x默认支持
* 只对一般身份使用者有效
* 若启用SELinux,非所有目录均可设置quota


<a id="markdown-72-相关指令" name="72-相关指令"></a>
## 7.2. 相关指令
```bash
# 列出目前系统的各个文件系统,以及文件系统的quota挂载参数支持
xfs_quota -x -c "print"

# 列出目前/home这个支持quota的载点的文件系统使用情况
xfs_quota -x -c "df -h" /home

# 列出目前/home的所有用户的quota限制值
xfs_quota -x -c "report -ubih" /home

# 列出目前支持的quota文件系统是否有启动了quota功能
xfs_quota -x -c "state"

# 设置user block限制值
xfs_quota -x -c "limit -u bsoft=250M bhard=300M myquota1" /home
xfs_quota -x -c "report -ubih" /home

# 设置group block限制值
xfs_quota -x -c "limit -g bsoft=950M bhard=1G myquotagrp" /home
xfs_quota -x -c "report -gbih" /home

# 测试
dd if=/dev/zero of=123.img bs=1M count=310

```

<a id="markdown-8-raid-容错式廉价磁盘阵列" name="8-raid-容错式廉价磁盘阵列"></a>
# 8. RAID 容错式廉价磁盘阵列
Redundant Arrays of Inexpensive Disks, RAID

* 容量
* 性能
* 数据可靠性

<a id="markdown-81-raid0-等量模式stripe-性能模式" name="81-raid0-等量模式stripe-性能模式"></a>
## 8.1. RAID0 (等量模式,stripe): 性能模式
使用相同型号与容量的磁盘来组成时,效果较佳,数据会被等量的放置在各个磁盘上面

<a id="markdown-82-raid1-映射模式mirror-完整备份" name="82-raid1-映射模式mirror-完整备份"></a>
## 8.2. RAID1 (映射模式,mirror): 完整备份
让同一份数据,完整的保存在两颗磁盘上头,整体的RAID的容量几乎少了50%,写入性能不佳,不过读取的性能还是可以的

<a id="markdown-83-raid-10-raid-01" name="83-raid-10-raid-01"></a>
## 8.3. RAID 1+0, RAID 0+1
![](http://ouxarji35.bkt.clouddn.com/snipaste_20171026_100106.png)

想象有20颗磁盘组成的系统,每两颗组成一个RAID1,因此你就有总共10组可以自己复原的系统了,然后这10组再组成一个新的RAID0,速度立刻拉升10倍

<a id="markdown-84-raid-5" name="84-raid-5"></a>
## 8.4. RAID 5
仅能支持一颗磁盘的损毁,读取性能和RAID-0有的比,不过写的性能就不见得能够增加很多  
Spare Disk: 预备磁盘功能,鸟哥的例子:  
> 举例来说，鸟哥之前所待的研究室有一个磁盘阵列可允许 16 颗磁盘的数量，不过我们只安装了 10 颗磁盘作为 RAID 5。 每颗磁盘的容量为 250GB，我们用了一颗磁盘作为 spare disk ，并将其他的 9 颗设置为一个 RAID 5， 因此这个磁盘阵列的总容量为： （9-1）*250G=2000G。运行了一两年后真的有一颗磁盘坏掉了，我们后来看灯号才发现！ 不过对系统没有影响呢！因为 spare disk 主动的加入支持，坏掉的那颗拔掉换颗新的，并重新设置成为 spare 后， 系统内的数据还是完整无缺的！嘿嘿！真不错！

![](http://ouxarji35.bkt.clouddn.com/snipaste_20171026_121738.png)


<a id="markdown-85-磁盘阵列的有优点" name="85-磁盘阵列的有优点"></a>
## 8.5. 磁盘阵列的有优点
* 数据安全与可靠性: 指的并非网络信息安全,而是当硬件(指磁盘)损毁时,数据是否还能够安全的救援或使用之意
* 读写性能: 例如RAID 0 可以加强读写性能,让你的I/O部分得以改善
* 容量: 可以让多颗磁盘组合起来,故单一文件系统可以有相当大的容量


![](http://ouxarji35.bkt.clouddn.com/snipaste_20171026_122423.png)


<a id="markdown-9-查看文件内容的多种方式" name="9-查看文件内容的多种方式"></a>
# 9. 查看文件内容的多种方式
```bash
# 由第一行开始显示文件内容
cat

# 从最后一行开始显示,可以看出tac是cat的倒着写!
tac

# 显示的时候,顺道输出行号
nl

# 一页一页的显示文件内容
more 

# 往前翻页
less

# 只看头几行
head

# 只看尾巴几行
tail

# 以二进制的方式读取文件内容
od
```



<a id="markdown-10-常用命令" name="10-常用命令"></a>
# 10. 常用命令
```bash

# 更改默认的
chmoddir=./
sudo find $chmoddir -type d -exec chmod 0755 {} \; 
sudo find $chmoddir -type f -exec chmod 0644 {} \; 

# 修改owner
sudo find . -type d -exec chown yq:yq {} \; 
sudo find . -type f -exec chown yq:yq {} \; 

# 更改默认所属
find . -type d -exec chown root:root {} \;
r

# 搜索可执行文件
which python3

# 由一些特定目录中寻找文件文件名
whereis python3

# 查看文件是什么类型
type python

# 索引定位,但是每天只更新一次数据库?/var/lib/mlocate
locate python3

# 查询系统用户相关信息
id pi

# 查看当前的群组
groups

# 创建多级目录
mkdir ./test/test/test -p

```


