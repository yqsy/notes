

<!-- TOC -->

- [1. iptables](#1-iptables)
    - [1.1. 各个链的详细功能](#11-各个链的详细功能)
        - [1.1.1. filter表](#111-filter表)
        - [1.1.2. nat表](#112-nat表)
        - [1.1.3. mangle表](#113-mangle表)
    - [1.2. 选项](#12-选项)
        - [1.2.1. 操作选项](#121-操作选项)
        - [1.2.2. 过滤选项](#122-过滤选项)
        - [1.2.3. 注意点,用tcp-reset代替drop](#123-注意点用tcp-reset代替drop)
        - [1.2.4. 参考书籍的](#124-参考书籍的)
- [2. 命令](#2-命令)

<!-- /TOC -->

<a id="markdown-1-iptables" name="1-iptables"></a>
# 1. iptables

<a id="markdown-11-各个链的详细功能" name="11-各个链的详细功能"></a>
## 1.1. 各个链的详细功能

<a id="markdown-111-filter表" name="111-filter表"></a>
### 1.1.1. filter表
| 链名称    | 链作用                                            |
| --------- | ------------------------------------------------- |
| INPUT链   | 主要是对外部数据包进入Linux系统进行信息过滤       |
| OUTPUT链  | 主要时对内部Linux系统索要发送的数据包进行信息过滤 |
| FORWARD链 | 将外面过来的数据包传递到内部计算机中              |


<a id="markdown-112-nat表" name="112-nat表"></a>
### 1.1.2. nat表
| 链名称        | 链作用                                                                                                                                                                              |
| ------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| PREROUTING链  | 是在数据包刚刚达到防火墙时,根据需要改变它的目的地址,例如DNAT操作,就是通过一个合法的公网IP地址,通过对防火墙的定向,重定向到防火墙内的其他计算机                                       |
| INPUT链       |
| OUTPUT链      | 改变了本地产生包的目的地址                                                                                                                                                          |
| POSTROUTING链 | 在包就要离开防火墙之前改变其源地址,例如SNAT操作,屏蔽了本地局域网主机的信息,本地主机通过防火墙链接到Inertnet,这样在Internet上看到的本地主机的来源地址都是同一个IP,屏蔽了来源主机信息 |


<a id="markdown-113-mangle表" name="113-mangle表"></a>
### 1.1.3. mangle表
不常用,不记录了

<a id="markdown-12-选项" name="12-选项"></a>
## 1.2. 选项

| 选项 | 选项作用描述                                                         |
| ---- | -------------------------------------------------------------------- |
| -t   | 后面接表                                                             |
| -L   | --list                                                               |
| -v   | 显示更多的信息                                                       |
| -n   | 输出结果用IP显示,显示速度会加快                                      |
| -F   | --flush清空某个指定table中所有链的规则设定                           |
| -X   | --delete-chain,删除使用者自定义的table chain                         |
| -Z   | --zero,将数据包计数器归零,数据包计数器是用来统计同一数据包出现的次数 |


<a id="markdown-121-操作选项" name="121-操作选项"></a>
### 1.2.1. 操作选项

| 选项     | 选项作用描述                                                                                        |
| -------- | --------------------------------------------------------------------------------------------------- |
| -A       | 新增加一条规则,放到已有规则的最后面                                                                 |
| -I       | 插入一条指定规则,如果没有指定插入规则的顺序,则新插入的变成第一条规则                                |
| -i       | 指定数据进入的那个网络接口,Linux下常见的有eth0,eth1.lo等,此参数一般与INPUT链配合使用                |
| -o       | 指定数据包传出的那个网络接口.经常与OUTPUT链配合使用                                                 |
| -p       | 指定此规则适用的协议,常用的协议有TCP,UDP,ICMP和ALL                                                  |
| -s       | 指定来源的IP或者网络,也就是限定数据包来源的IP或者网络,可以单独指定某个IP,也可以指定某段网络         |
| -d       | 指定目标IP或者网络                                                                                  |
| -j       | 此参数后面指定要执行的动作,主要的动作有接受(ACCEPT),抛弃(DROP)及记录(LOG)                           |
| ACCEPT   | 接受该数据包                                                                                        |
| DROP     | 直接丢弃该数据包,不给客户端任何回应                                                                 |
| REJECT   | 拦截该数据封包,并发送封包通知对方,可以发送的封包有`icmp-port-unreacgable,tcp-reset,icmp-echo-reply` |
| REDIRECT | 用在nat表中,主要用于将封包请求重定向到另一个端口,处理完毕此规则,将继续比对其他规则                  |

<a id="markdown-122-过滤选项" name="122-过滤选项"></a>
### 1.2.2. 过滤选项
| 选项             | 选项作用描述                                                                                                                                                                                                                       |
| ---------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| --sport 端口范围 | 限制来源的端口号码,端口号码可以是连续的,例如1024:65535                                                                                                                                                                             |
| --dport 端口范围 | 限制目标的端口号码                                                                                                                                                                                                                 |
| -m               | 模块选项<br/>state: 状态模块<br/>mac: 网卡硬件地址                                                                                                                                                                                 |
| --state          | NEW: 表示这个包是我们看到的第一个包<br/>ESTABLISHED: 表示该封包属于某个已经建立的连接<br/>RELATED: 当一个连接和某个已处于ESTABLISHED状态的连接有关系时,就被认为是RELATED<br/>INVALID: 表示数据包不能被识别属于哪个连接或者没有状态 |

<a id="markdown-123-注意点用tcp-reset代替drop" name="123-注意点用tcp-reset代替drop"></a>
### 1.2.3. 注意点,用tcp-reset代替drop
* http://blog.csdn.net/q345852047/article/details/7322317


<a id="markdown-124-参考书籍的" name="124-参考书籍的"></a>
### 1.2.4. 参考书籍的
![](http://ouxarji35.bkt.clouddn.com/snipaste_20170901_073422.png)


<a id="markdown-2-命令" name="2-命令"></a>
# 2. 命令

```bash
# 查看
sudo iptables -S

# 存储
iptables-save > /etc/network/iptables.rules

# 恢复
cat /etc/network/iptables.rules | sudo iptables-restore -c

```
