---
title: 消息队列顺序问题
date: 2017-11-28 20:50:00
categories: [工程问题]
---

<!-- TOC -->

- [1. 遇到的问题](#1-遇到的问题)
- [2. 又遇到的问题](#2-又遇到的问题)
- [3. 相关资料](#3-相关资料)

<!-- /TOC -->


<a id="markdown-1-遇到的问题" name="1-遇到的问题"></a>
# 1. 遇到的问题
交易系统中,一直听说到一些工程问题.例如:
* 撤单回报比成交回报先到了(明明单子已经撤掉了,还给我成交回报)
* (代码里看到)撤单回报回来了,发现单子的状态是Pending new,补发new
* (代码里看到)成交回报回来了,发现单子的状态是pending cancl,补发撤单拒绝

其实这种问题根本不需要应用层去用一些很魔幻的手段调整消息的顺序,或者补发一些消息,而是需要一个可靠的消息队列,实现
* 消息的顺序
* 消息的可靠补发(例如单点关闭了,启动或换机器之后能补发)

(当然只是一个猜想,需要给我一个具体的场景实践)

<a id="markdown-2-又遇到的问题" name="2-又遇到的问题"></a>
# 2. 又遇到的问题

411601 -> 给fg pending new > extcall 854002 > InsertEntrust 产生了上面的错误  1933883582 17:32:51 24411

pending new 已经给了对手方,v8已经收到了单子, InsertEntrust 时发生错误
导致确认回报854020回来时,以及成交回报854024回来时找不到相应的订单

(我觉得这世界上没有比这种问题更蠢的了,我会在以后总结出一套全方位解决这种问题的方案)

<a id="markdown-3-相关资料" name="3-相关资料"></a>
# 3. 相关资料

[消息队列.md](../micro_service/消息队列.md)
